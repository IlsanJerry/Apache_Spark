## RDD - 스파크

-스파크는 데이터처리를 RDD라는 자료구조로 처리한다.

스파크의 프로그래밍 모델을 RDD를 가공해서, 새로운 RDD를 만들고,

이런 처리를 반복하여 원하는 결과를 얻는 형태이다.

```

```

1.RDD 구조 및 특징

-대량의 데이터를 요소로 가지는 분산 컬렉션이다.

-여러 머신으로 구성된 클러스트 환경에서의 분산처리를 전제로 설계되었고

​	내부는 파티션이라는 단위로 나뉜다. (파티션은 곧 분산처리 단위다.)

-RDD를 파티션 단위로 여러 머신에서 처리하므로,

​	한대의 머신으로 처리 할 수 있는것보다 큰 데이터를 다룰 수있다.



#### 	RDD구조

​	-1.HDFS등 분산 파일 시스템에 있는 파일 내용을 RDD로 로드한다.

​	-2.그 후 RDD를 가공해서 , 대량의 데이터를 분산처리 할 수 있다.

​		해당 작업을 ''변환''(Transformation)이라고 한다.

​	-3.RDD의 내용에 따라서 "액션"(Action)이라는 처리를 적용하여

​		원하는 결과를 얻는다.

```

```

#### 	RDD의 생성 , 가공 , 결과 취득

​		1. HDFS 등의 분산 파일 시스템에 분석에 필요한 데이터를 가지고 온다. (이하 예시)

```reStructuredText
ex: 송이버섯,마늘,양파,표고버섯,당근,잎새버섯,가닥버섯,미역 (text파일)
```

```

```

​		2. 해당 text 파일의 내용으로 RDD를 생성하되,

​			배열 혹은 리스트 단위 요소로 저장하는 RDD를 생성한다.

```reStructuredText
ex: 송이버섯,마늘,양파,표고버섯,당근,잎새버섯,가닥버섯,미역 (RDD 생성(배열or리스트형태))
```

```

```

​		3.해당 데이터들 중에 "버섯류 만 추출" 하고 싶을 때, 

​			기존의 RDD를 변환하여 "버섯류 추출"을 수행 후 ,

​			새로운 RDD를 생성한다.

```reStructuredText
ex: 송이버섯,표고버섯,잎새버섯,가닥버섯 (버섯류만 추출한 "새로운 RDD 생성(배열or리스트형태))
```

```

```

​		4.버섯류만 추출한 RDD에서 "상품수를 카운트"하고 싶을 때,

​			변환된 새로운 RDD에 상품수를 카운트하는 "액션(Action)"을 적용한다.

```
ex: 결과 : 상품수 4개!
```

```

```

cf. RDD의 추가 특징

	1. 내부 요소값이 변경이 불가능하다.
 	2. 생성이나 변환이 지연 평가되는 성질이 있다.(*Lazy* evaluation)

```



```



#### RDD 다루기

##### 1.변환

-RDD를 가공하고 그 결과 새로운 RDD를 얻는 것이다. 

​	변환 처리 후의 RDD가 가지는 요소는, 변환처리 전의 RDD에 들어있던

​	요소를 가공하거나 필터링해 생성된다.

- ##### Filter : 요소를 필터한다 

  (특정 요소가 필터링 대상인지 여부를 판정할 때, 다른 요소는 고려하지 않는다.)

- ##### Map : 각 요소에 동일한 처리를 적용한다

- ##### FlatMap : 각 요소에 동일한 처리를 적용하고 여러 개의 요소를 생성한다.

  (특정 문장을 분할 할때 다른 문장은 필요없다.( ex)문장을 단어로 분해시) )

- ##### Zip : 파티션 수가 같고, 파티션에 있는 요소의 수도 같은 두 개의 RDD를 조합해 

  한쪽의 요소 값을 키로, 다른 한쪽의 요소 값을 벨류로 가지는 쌍(Key-Value)을 만든다.

  ```
  
  ```

- ##### reduceByKey : 같은 키를 가지는 요소를 집약처리(aggregation)한다.

  (ex: 1.(식재료 품목,1)의 Key-Value쌍을 요소로 가지는 RDD )

  ​		2.=========================>셔플=====================>

  ​			(셔플 직후 같은 키를 가지는 요소가 모여 있는 중간 상태가 존재함.)

  ​		3.(식재료 품목,품목수)의 Key-Value쌍을 요소로 가지는 새로운 RDD)

  ​			(셔플 결과로 집약처리한 결과임)

  ```
  
  ```

- ##### join : 두 개의 RDD에서 같은 키를 가지는 요소끼리 조인한다.

  (ex: 1.(상품명,단가)와(상품명,구입개수)  각각 Key-Value로 갖는 RDD2개 존재.

  ​		2.=========================>셔플=====================>

  ​			(셔플 직후 같은 키를 가지는 요소가 모여 있는 중간 상태가 존재함.)

  ​		3.상품명을 Key로 삼아 단가와 구입개수를 조인한다.

  ​		4.(상품명,(단가,구입개수))의 RDD탄생.

  ```
  
  
  ```

  ##### 2.액션

  -변환이 RDD로부터 다른 RDD를 얻는 "데이터 가공"에 해당되는 조작이라면,

  -액션은 RDD 내용을 바탕으로 데이터를 가공하지 않고 원하는 결과를 얻는 조작!

  

- ##### saveAsTextFile: RDD의 내용을 파일로 출력한다.

  (ex: 한국어 동물 이름과 , 영어 동물 이름을 쌍으로 가지는 RDD)

  [ (고양이,cat)(개,dog) ] [ (여우,fox)(호랑이,tiger)(새,bird) ]으로

  한 RDD안에 2개의 파티션으로 나누어서 저장되어 있으면

  ##### 같은 디렉토리에, 파티션 단위로 각 파일을 따로 출력한다.

- count : RDD의 요소 수를 센다.

  